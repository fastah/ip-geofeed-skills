<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geofeed Tuner Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/bootstrap-5.3.8-dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #adadad;
            padding: 20px;
            font-family: 'Raleway', sans-serif;
        }
        .report-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .metadata {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .metadata h3 {
            margin-bottom: 15px;
            color: #333333;
        }
        .metadata-item {
            display: inline-block;
            margin-right: 40px;
            margin-bottom: 10px;
        }
        .metadata-label {
            font-weight: bold;
            color: #696969;
        }
        .metadata-value {
            color: #333333;
        }
        .status-badge {
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
            display: inline-block;
            min-width: 120px;
            text-align: center;
        }
        .status-error {
            background-color: #ff707f;
            color: #ffffff;
            border: 1px solid #ff707f;
        }
        .status-warning {
            background-color: #ffdc73;
            color: #000000;
            border: 1px solid #ffdc73;
        }
        .status-suggestion {
            background-color: #1877ec;
            color: #ffffff;
            border: 1px solid #1877ec;
        }
        .status-ok {
            background-color: #28a745;
            color: #ffffff;
            border: 1px solid #28a745;
        }
        .entries-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
        }
        .entries-table thead {
            background-color: #4a4a4a;
            color: white;
        }
        .entries-table th {
            padding: 12px;
            text-align: left;
            border: 1px solid #d3d3d3;
            font-weight: 600;
            background-color: #6b6b6b;
            color: #ffffff;
        }
        .entries-table td {
            padding: 12px;
            border: 1px solid #d3d3d3;
            vertical-align: top;
        }
        .entries-table tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }
        .entries-table tbody tr:hover {
            background-color: #f0f0f0;
        }
        .messages-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .messages-list li {
            padding: 5px 0;
            border-left: 3px solid #b0b0b0;
            padding-left: 10px;
            color: #696969;
            font-size: 0.95em;
        }
        .region-suggestions {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            font-size: 0.95em;
        }
        .region-suggestion-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #d3d3d3;
        }
        .region-suggestion-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #555555;
            text-align: center;
        }
        .stat-card.error {
            border-left-color: #666666;
        }
        .stat-card.warning {
            border-left-color: #b0b0b0;
        }
        .stat-card.suggestion {
            border-left-color: #808080;
        }
        .stat-card .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #333333;
        }
        .stat-card .stat-label {
            font-size: 0.9em;
            color: #696969;
            margin-top: 5px;
        }
        h1 {
            color: #ffffff;
            margin-bottom: 10px;
            margin-top: -30px;
            margin-left: -30px;
            margin-right: -30px;
            border-bottom: none;
            padding-bottom: 10px;
            font-size: 3em;
            font-weight: 700;
            font-family: 'Raleway', sans-serif;
            background: linear-gradient(135deg, #2a2a2a 0%, #4a4a4a 100%);
            padding: 30px;
            border-radius: 15px 15px 0 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .input-file {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 3px;
            word-break: break-all;
            font-family: monospace;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto 20px auto;
            border-radius: 8px;
            overflow: hidden;
        }
        .metrics-table td {
            padding: 10px 15px;
            border: 1px solid #d3d3d3;
        }
        .metrics-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .metrics-label {
            font-weight: bold;
            width: 30%;
            background-color: #f0f0f0;
        }
        .metrics-value {
            width: 70%;
            color: #333333;
        }
        .metrics-table.feed-metadata .metrics-label {
            width: 20%;
        }
        .metrics-table.feed-metadata .metrics-value {
            width: 80%;
        }
        .accuracy-summary-table td {
            width: auto !important;
        }
        .accuracy-summary-table .metrics-label {
            width: 15% !important;
        }
        .accuracy-summary-table .metrics-value {
            width: 35% !important;
        }
        #filterCountry, #filterRegion, #filterCity, #filterStatus {
            box-sizing: border-box;
            font-family: 'Raleway', sans-serif;
        }
        #filterCountry::placeholder, #filterRegion::placeholder, #filterCity::placeholder {
            color: #aaa;
        }
        #resetFilters:hover {
            background-color: #6a6a6a;
            border-color: #aaa;
        }
    </style>
</head>
<body>
    <div class="report-container">
        <h1>Geofeed Tuner Report<br><span style="font-size: 0.4em; font-weight: 700; display: block; margin-top: 10px;">RFC 8805 Validation & Recommendations</span></h1>
        
        <table class="metrics-table feed-metadata" style="margin-top: 30px; margin-bottom: 30px;">
            <tr style="background-color: #6b6b6b;">
                <td colspan="2" style="padding: 12px 15px; font-weight: bold; color: #ffffff; font-size: 1.1em; font-family: 'Raleway', sans-serif;">Feed Metadata</td>
            </tr>
            <tr>
                <td class="metrics-label"><i class="fas fa-file-csv" style="margin-right: 8px;"></i>Input file</td>
                <td class="metrics-value"><span id="inputFileMetrics">geolocation.csv</span></td>
            </tr>
            <tr>
                <td class="metrics-label"><i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>Tuning timestamp</td>
                <td class="metrics-value"><span id="tuningTimestamp">2026-01-31T12:00:00.000000+00:00</span></td>
            </tr>
        </table>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <table class="metrics-table">
                <tr style="background-color: #6b6b6b;">
                    <td colspan="2" style="padding: 12px 15px; font-weight: bold; color: #ffffff; font-size: 1.1em; font-family: 'Raleway', sans-serif;">Entries</td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-list" style="margin-right: 8px;"></i>Total entries</td>
                    <td class="metrics-value"><span id="totalEntriesMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-network-wired" style="margin-right: 8px;"></i>IPv4 entries</td>
                    <td class="metrics-value"><span id="ipv4EntriesMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-network-wired" style="margin-right: 8px;"></i>IPv6 entries</td>
                    <td class="metrics-value"><span id="ipv6EntriesMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>Invalid entries</td>
                    <td class="metrics-value"><span id="invalidEntriesMetrics">0</span></td>
                </tr>
            </table>
            
            <table class="metrics-table">
                <tr style="background-color: #6b6b6b;">
                    <td colspan="2" style="padding: 12px 15px; font-weight: bold; color: #ffffff; font-size: 1.1em; font-family: 'Raleway', sans-serif;">Analysis Summary</td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-times-circle" style="margin-right: 8px;"></i>Errors</td>
                    <td class="metrics-value"><span id="errorCountMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>Warnings</td>
                    <td class="metrics-value"><span id="warningCountMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-lightbulb" style="margin-right: 8px;"></i>Suggestions</td>
                    <td class="metrics-value"><span id="suggestionsMetrics">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-check-circle" style="margin-right: 8px;"></i>OK </td>
                    <td class="metrics-value"><span id="okCountMetrics">0</span></td>
                </tr>
            </table>
        </div>
        
        <div style="margin-bottom: 40px;">
            <table class="metrics-table accuracy-summary-table" style="margin-top: 0; margin-bottom: 0; table-layout: fixed; width: 100%;">
                <colgroup>
                    <col style="width: 20%;">
                    <col style="width: 30%;">
                    <col style="width: 20%;">
                    <col style="width: 30%;">
                </colgroup>
                <tr style="background-color: #6b6b6b;">
                    <td colspan="4" style="padding: 12px 15px; font-weight: bold; color: #ffffff; font-size: 1.1em; font-family: 'Raleway', sans-serif;">Accuracy Summary</td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-city" style="margin-right: 8px;"></i>City-level accuracy</td>
                    <td class="metrics-value"><span id="cityAccuracy">0</span></td>
                    <td class="metrics-label"><i class="fas fa-map" style="margin-right: 8px;"></i>Region-level accuracy</td>
                    <td class="metrics-value"><span id="regionAccuracy">0</span></td>
                </tr>
                <tr>
                    <td class="metrics-label"><i class="fas fa-globe" style="margin-right: 8px;"></i>Country-level accuracy</td>
                    <td class="metrics-value"><span id="countryAccuracy">0</span></td>
                    <td class="metrics-label"><i class="fas fa-ban" style="margin-right: 8px;"></i>Do-not-geolocate entries</td>
                    <td class="metrics-value"><span id="doNotGeolocate">0</span></td>
                </tr>
            </table>
        </div>

        <div style="overflow-x: auto;">
            <table class="entries-table">
                <thead>
                    <tr style="background-color: #4a4a4a;">
                        <th colspan="8" style="padding: 15px; font-weight: bold; color: #ffffff; font-size: 1.4em; font-family: 'Raleway', sans-serif;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span><i class="fas fa-list" style="margin-right: 10px;"></i>Entries</span>
                                <div style="display: flex; gap: 10px; font-size: 0.75em; font-weight: 400;">
                                    <input type="text" id="filterCountry" placeholder="Country" style="padding: 6px 10px; border: 1px solid #888; border-radius: 4px; background-color: #5a5a5a; color: #ffffff;">
                                    <input type="text" id="filterRegion" placeholder="Region" style="padding: 6px 10px; border: 1px solid #888; border-radius: 4px; background-color: #5a5a5a; color: #ffffff;">
                                    <input type="text" id="filterCity" placeholder="City" style="padding: 6px 10px; border: 1px solid #888; border-radius: 4px; background-color: #5a5a5a; color: #ffffff;">
                                    <select id="filterStatus" style="padding: 6px 10px; border: 1px solid #888; border-radius: 4px; background-color: #5a5a5a; color: #ffffff;">
                                        <option value="">Status</option>
                                        <option value="ERROR">ERROR</option>
                                        <option value="WARNING">WARNING</option>
                                        <option value="SUGGESTION">SUGGESTION</option>
                                        <option value="OK">OK</option>
                                    </select>
                                    <button id="resetFilters" style="padding: 6px 12px; border: 1px solid #888; border-radius: 4px; background-color: #5a5a5a; color: #ffffff; cursor: pointer; font-weight: 600;">Reset</button>
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr>
                        <th>Line</th>
                        <th>IP Prefix</th>
                        <th>Country</th>
                        <th>Region</th>
                        <th>City</th>
                        <th>Status</th>
                        <th>Messages</th>
                        <th>Region Suggestions</th>
                    </tr>
                </thead>
                <tbody id="entriesTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Hardcoded JSON data
        const data = {
  "input_file": "C:\\Users\\naikk\\OneDrive\\Documents\\Fastah\\ip-geofeed-skills\\skills\\geofeed-tuner\\assets\\example\\01-user-input-rfc8805-feed.csv",
  "tuning_timestamp": "2026-02-05T23:25:36.487178+00:00",
  "total_entries": 4,
  "ipv4_entries": 2,
  "ipv6_entries": 2,
  "error_count": 1,
  "warning_count": 1,
  "ok_count": 0,
  "city_level_accuracy": 1,
  "region_level_accuracy": 0,
  "country_level_accuracy": 3,
  "do_not_geolocate_entries": 0,
  "entries": [
    {
      "line": 1,
      "ip_prefix": "202.125.100.144/28",
      "country": "ID",
      "flag_svg": "https://flagcdn.com/id.svg",
      "region": "",
      "city": "Jakarta",
      "status": "SUGGESTION",
      "messages": [
        {
            "status": "SUGGESTION",
            "message": "Region code is recommended when a city is specified; choose a region from the dropdown"
        }
      ],
      "need_region": true,
      "has_error": false,
      "has_warning": false,
      "has_suggestion": true,
      "is_small_territory": false,
      "region_suggestions": [
        {
          "region_code": "ID-JK",
          "region_name": "Jakarta",
          "relevance": 1.0
        }
      ]
    },
    {
      "line": 2,
      "ip_prefix": "2605:59c8:2700::/40",
      "country": "CA",
      "region": "",
      "flag_svg": "https://flagcdn.com/ca.svg",
      "city": "Montreal",
      "status": "WARNING",
      "messages": [
        {
            "status": "WARNING",
            "message": "IPv6 prefix is unusually large and may indicate a typo"
        },
        {
            "status": "SUGGESTION",
            "message": "Region code is recommended when a city is specified; choose a region from the dropdown"
        }
      ],
      "need_region": true,
      "has_error": false,
      "has_warning": true,
      "has_suggestion": true,
      "is_small_territory": false,
      "region_suggestions": [
        {
          "region_code": "CA-QC",
          "region_name": "Quebec",
          "relevance": 1.0
        }
      ]
    },
    {
      "line": 3,
      "ip_prefix": "150.228.170.0/24",
      "country": "SG",
      "region": "",
      "flag_svg": "https://flagcdn.com/sg.svg",
      "city": "Singapore",
      "status": "SUGGESTION",
      "messages": [
        {
            "status": "SUGGESTION",
            "message": "City-level granularity is usually unnecessary for small territories; consider removing the city value"
        }
      ],
      "need_region": false,
      "has_error": false,
      "has_warning": false,
      "has_suggestion": true,
      "is_small_territory": true,
      "region_suggestions": []
    },
    {
      "line": 5,
      "ip_prefix": "2406:2d40:8100::/42",
      "country": "SG",
      "flag_svg": "https://flagcdn.com/sg.svg",
      "region": "SG",
      "city": "Singapore",
      "status": "ERROR",
      "messages": [
        {
            "status": "WARNING",
            "message": "IPv6 prefix is unusually large and may indicate a typo"
        },
        {
            "status": "ERROR",
            "message": "Invalid region format; expected COUNTRY-SUBDIVISION (e.g., US-CA)"
        }
      ],
      "need_region": false,
      "has_error": true,
      "has_warning": true,
      "has_suggestion": false,
      "is_small_territory": true,
      "region_suggestions": []
    }
  ]
};

        // Load and process the data
        function loadData() {
            // Populate metadata
            document.getElementById('inputFileMetrics').textContent = data.input_file;
            document.getElementById('tuningTimestamp').textContent = data.tuning_timestamp;
            
            // Populate entries metrics table
            document.getElementById('totalEntriesMetrics').textContent = data.total_entries;
            document.getElementById('ipv4EntriesMetrics').textContent = data.ipv4_entries;
            document.getElementById('ipv6EntriesMetrics').textContent = data.ipv6_entries;
            
            // Count invalid entries
            let invalidCount = 0;
            data.entries.forEach(entry => {
                if (entry.has_error) {
                    invalidCount++;
                }
            });
            document.getElementById('invalidEntriesMetrics').textContent = invalidCount;
            
            // Populate analysis summary metrics table
            document.getElementById('errorCountMetrics').textContent = data.error_count;
            document.getElementById('warningCountMetrics').textContent = data.warning_count;
            
            // Count suggestions from entries
            let suggestionCount = 0;
            data.entries.forEach(entry => {
                if (entry.status === 'SUGGESTION') {
                    suggestionCount++;
                }
            });
            document.getElementById('suggestionsMetrics').textContent = suggestionCount;
            document.getElementById('okCountMetrics').textContent = data.ok_count;
            
            // Populate accuracy
            document.getElementById('cityAccuracy').textContent = data.city_level_accuracy;
            document.getElementById('regionAccuracy').textContent = data.region_level_accuracy;
            document.getElementById('countryAccuracy').textContent = data.country_level_accuracy;
            document.getElementById('doNotGeolocate').textContent = data.do_not_geolocate_entries;
            
            // Populate entries table
            const tableBody = document.getElementById('entriesTableBody');
            data.entries.forEach(entry => {
                const row = document.createElement('tr');
                
                // Determine status badge class and icon
                let statusClass = 'status-ok';
                let statusIcon = '<i class="fas fa-check-circle" style="margin-right: 6px;"></i>';
                if (entry.status === 'ERROR') {
                    statusClass = 'status-error';
                    statusIcon = '<i class="fas fa-times-circle" style="margin-right: 6px;"></i>';
                } else if (entry.status === 'WARNING') {
                    statusClass = 'status-warning';
                    statusIcon = '<i class="fas fa-exclamation-triangle" style="margin-right: 6px;"></i>';
                } else if (entry.status === 'SUGGESTION') {
                    statusClass = 'status-suggestion';
                    statusIcon = '<i class="fas fa-lightbulb" style="margin-right: 6px;"></i>';
                }
                
                // Messages list
                let messagesHtml = '<ul class="messages-list">';
                if (entry.messages && entry.messages.length > 0) {
                    entry.messages.forEach(msg => {
                        let msgStatus = msg.status || 'INFO';
                        let msgText = msg.message || msg;
                        let msgIcon = '<i class="fas fa-info-circle" style="margin-right: 6px; color: #999; opacity: 0.7;"></i>';
                        
                        if (msgStatus === 'ERROR') {
                            msgIcon = '<i class="fas fa-times-circle" style="margin-right: 6px; color: #999; opacity: 0.7;"></i>';
                        } else if (msgStatus === 'WARNING') {
                            msgIcon = '<i class="fas fa-exclamation-triangle" style="margin-right: 6px; color: #999; opacity: 0.7;"></i>';
                        } else if (msgStatus === 'SUGGESTION') {
                            msgIcon = '<i class="fas fa-lightbulb" style="margin-right: 6px; color: #999; opacity: 0.7;"></i>';
                        } else if (msgStatus === 'OK') {
                            msgIcon = '<i class="fas fa-check-circle" style="margin-right: 6px; color: #999; opacity: 0.7;"></i>';
                        }
                        
                        messagesHtml += `<li>${msgIcon}${escapeHtml(msgText)}</li>`;
                    });
                }
                messagesHtml += '</ul>';
                
                // Region suggestions
                let suggestionsHtml = '';
                if (entry.region_suggestions && entry.region_suggestions.length > 0) {
                    suggestionsHtml = '<div class="region-suggestions">';
                    entry.region_suggestions.forEach(suggestion => {
                        suggestionsHtml += `
                            <div class="region-suggestion-item">
                                <i class="fas fa-map-marker-alt" style="margin-right: 6px; color: #4a4a4a;"></i><strong>${escapeHtml(suggestion.region_code)}</strong> - ${escapeHtml(suggestion.region_name)}
                                <br><small style="color: #999;"><i class="fas fa-check" style="margin-right: 4px;"></i>Relevance: ${(suggestion.relevance * 100).toFixed(0)}%</small>
                            </div>
                        `;
                    });
                    suggestionsHtml += '</div>';
                } else {
                    suggestionsHtml = '<span style="color: #999;"><i class="fas fa-minus-circle" style="margin-right: 6px;"></i>None</span>';
                }
                
                row.innerHTML = `
                    <td>${entry.line}</td>
                    <td><strong>${escapeHtml(entry.ip_prefix)}</strong></td>
                    <td><img src="${entry.flag_svg}" style="width: 24px; height: 16px; margin-right: 8px; vertical-align: middle; border-radius: 2px; box-shadow: 0 1px 3px rgba(0,0,0,0.2);"> ${escapeHtml(entry.country)}</td>
                    <td>${entry.region ? escapeHtml(entry.region) : '<span style="color: #999;">-</span>'}</td>
                    <td>${entry.city ? escapeHtml(entry.city) : '<span style="color: #999;">-</span>'}</td>
                    <td><span class="status-badge ${statusClass}">${statusIcon}${entry.status}</span></td>
                    <td>${messagesHtml}</td>
                    <td>${suggestionsHtml}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Helper function to escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        // Function to apply filters
        function applyFilters() {
            const countryFilter = document.getElementById('filterCountry').value.toLowerCase();
            const regionFilter = document.getElementById('filterRegion').value.toLowerCase();
            const cityFilter = document.getElementById('filterCity').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            
            const tableBody = document.getElementById('entriesTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const country = cells[2]?.textContent.toLowerCase() || '';
                const region = cells[3]?.textContent.toLowerCase() || '';
                const city = cells[4]?.textContent.toLowerCase() || '';
                const status = cells[5]?.textContent.trim().toUpperCase() || '';
                
                const countryMatch = country.includes(countryFilter);
                const regionMatch = region.includes(regionFilter);
                const cityMatch = city.includes(cityFilter);
                const statusMatch = statusFilter === '' || status.includes(statusFilter);
                
                if (countryMatch && regionMatch && cityMatch && statusMatch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Load data when page loads
        window.addEventListener('DOMContentLoaded', function() {
            loadData();
            
            // Add filter event listeners
            document.getElementById('filterCountry').addEventListener('input', applyFilters);
            document.getElementById('filterRegion').addEventListener('input', applyFilters);
            document.getElementById('filterCity').addEventListener('input', applyFilters);
            document.getElementById('filterStatus').addEventListener('change', applyFilters);
            
            // Reset filters button
            document.getElementById('resetFilters').addEventListener('click', function() {
                document.getElementById('filterCountry').value = '';
                document.getElementById('filterRegion').value = '';
                document.getElementById('filterCity').value = '';
                document.getElementById('filterStatus').value = '';
                applyFilters();
            });
        });
    </script>
</body>
</html>
